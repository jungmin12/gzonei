//페이지 뜰때 로딩
var flag = true;
//지역1 코드
var area1CodeList = [];
//사업지구 코드
//var dsCodeList = [];
function printInfo(){
	$("#info .scroll").print({
        globalStyles : true,
        mediaPrint : false,
        iframe : true,
        noPrintSelector : ".avoid-this",
    });
}
$( document ).ready(function() {
	recDevInfoLogHist();
	
	var lon = $('#lon').val();
	var lat = $('#lat').val();
	if(lon != null && lon !=''){
		devInfoListSearch('search',lon,lat);
		areaSetup();
	}else{
		devInfoListSearch('init',null,null);
	}
	//사업지구 하위 Depth Level 기본값(안보이게)
	$('#ds2, #ds3, #ds4').css('display','none');
	//프린트
	
	
	//추진내역 default 숨기기
	$('#prtnDetailContentsDiv').css('display','none');
	$('#prtnInsertContentsDiv').css('display','none');
	//개발정보 검색(버튼)
	$('#listSearch').on('click',function(e){
		//devInfoListSearch('Search',null,null);
	});
	//개발사업 정보 등록 페이지 열기 (버튼) -- 관리자
	$('#showInsertBtn').on('click',function(e){
		$('#devlopInfoInsertModal').css('display','block');
		$('#devlopInfoDetailModal').css('display','none');
	});
	//개발사업 정보 등록 (버튼) -- 관리자
	$('#devlopInfoInsertBtn').on('click',function(e){
		devlopInfoInsert();
	});
	
	//개발사업 정보 상세보기 (테이블 목록 클릭) -- 관리자
	$('#tbodyContents').on('click','tr',function(e){
		devlopInfoDetail(e.currentTarget.id);
	});
	
	//개발사업 상세보기,등록페이지 닫기(버튼) -- 관리자
	$('#devlopInfoCancleBtn, #devlopInfoDetailModal_CloseSpan, #devlopInfoInsertCancleBtn, #devlopInfoInsertModal_CloseSpan').on('click', function(e){
		$('#devlopInfoDetailModal').css('display','none');
		$('#devlopInfoInsertModal').css('display','none');
		$('#prtnDetailContentsDiv').css('display','none');
		$('#prtnInsertContentsDiv').css('display','none');
	});
	//개발사업 정보 수정 (버튼) -- 관리자
	$('#devlopInfoUpdateBtn').on('click',function(e){
		devlopInfoUpdate();
	});
	//개발사업 정보 삭제 (버튼) -- 관리자
	$('#devlopInfoDeleteBtn').on('click',function(e){
		devlopInfoDelete();
	});
	//추진내역 등록폼 보이기 (버튼) -- 관리자
	$('#showInsertFormBtn').on('click',function(e){
		$('#prtnDetailContentsDiv').css('display','none');
		$('#prtnInsertContentsDiv').css('display','block');
		showInsertForm();
	});
	//추진내역 등록폼/상세보기 없애기 (버튼) -- 관리자
	$('#PrtnInsertCancleBtn, #PrtnDetailCancleBtn').on('click',function(e){
		$('#prtnDetailContentsDiv').css('display','none');
		$('#prtnInsertContentsDiv').css('display','none');
	});
	//추진내역 정보 상세보기 (테이블 목록 클릭) -- 관리자
	$('#prtnListTbodyContents').on('click','tr',function(e){
		$('#prtnInsertContentsDiv').css('display','none');
		$('#prtnDetailContentsDiv').css('display','block');
		showDetailForm(e.currentTarget.id);
	});
	//추진내역 정보 등록 (버튼) -- 관리자
	$('#PrtnInsertBtn').on('click',function(e){
		PrtnInsert();
	});
	//추진내역 정보 수정 (버튼) -- 관리자
	$('#PrtnUpdateBtn').on('click',function(e){
		PrtnUpdate();
	});
	//추진내역 정보 삭제 (버튼) -- 관리자
	$('#PrtnDeleteBtn').on('click',function(e){
		PrtnDelete();
	});
	//----------------------사용자 START------------------------
	
	
	//개발사업정보 목록 -- 사용자
	$('#devInfoUserBtn').on('click',function(e){
		//아이디를 parameter로
		devInfoListSearch('Search',null,null);
	});
	//개발사업정보 상세보기>레이어로 줌,최근열람사업에 추가 -- 사용자
	$('.searchResult__obj').on('click','div.item',function(e){
		//아이디를 parameter로
		zoomLayer(e.currentTarget.id,"gz_devlop_info");
		
	});
	//개발사업정보 상세보기 > 투자정보 -- 사용자
	$('#infoObject').on('click',function(e){
		//alert(document.devInfoDtlForm.devlopInfoSn.value);
		//아이디를 parameter로
		//devInfoDtl(e.currentTarget.id);
		devInfoInvtList(document.devInfoDtlForm.dwkNo.value);
	});
	//개발사업정보 상세보기 > 관련기사 --- 사용자
	$('#infoParagraph').on('click',function(e){
		//아이디를 parameter로
		devInfoArticle(document.devInfoDtlForm.dwkNm.value);
	});
	$('#infoAdd').on('click',function(e){
		//$('#devInfoModifyGroup').css('display','block');
		devInfoIntrst(document.devInfoDtlForm.dwkNo.value);
	});
	$('#devInfoIntrstAddBtn').on('click',function(e){
		devInfoIntrstInsert(document.devInfoDtlForm.dwkNo.value);
	});
	
	//----------------------사용자 END------------------------

	
	//추진내역 정보 상세보기 (테이블 목록 클릭) -- 관리자
	$('#devInfoDtl_fileList').on('click','a', function(e){
		alert(e.currentTarget.dataset.filepath+e.currentTarget.dataset.filenm);
	});
	
	//지역1선택시 지역2 select 생성 이벤트
	$('.area1, .area2, .invArea1, .invArea2').on('change',function(e){
		var target = e.currentTarget; 
		var idOnly = target.id.substring(0,target.id.length-1);
		var lastInt = parseInt(target.id.charAt(target.id.length-1))+1;
		var nextInt = lastInt + 1;
		var selectTagId = target.parentElement.parentElement.querySelectorAll('.'+idOnly+lastInt)[0].id;
		//지역1에 대한 지역2 리스트 생성
		var resultData = getCodeAjax('AREA',$(this).val());
		if(resultData.length != 0){
			var sortCodeList = resultData.codeList.sort(function(a, b) {
				return a.lowestAreaNm < b.lowestAreaNm ? -1 : a.lowestAreaNm > b.lowestAreaNm ? 1 : 0;
			});
			devInfoOptionset(sortCodeList,selectTagId,'전체','없음');
			if(resultData.codeList.length ==0){
				if(lastInt == 2){
					var emptyList = [];
					devInfoOptionset(emptyList,idOnly+nextInt,'전체','없음');
				}
			}
		}
	});
	//보상시작년도 전체 선택시 기간도 전체로 바꾸는 이벤트
	$('.rwYr').on('change',function(e){
		var id = e.currentTarget.id;
		if($('#'+id).val()==""){
			$('#'+id+'Range').val('');
		}
	});
	//사업지구 select 생성 이벤트
	$('.ds1, .ds2, .ds3, .cp1, .invDs1, .invDs2, .invDs3').on('change',function(e){
		var target = e.currentTarget; 
		var idOnly = target.id.substring(0,target.id.length-1);
		var lastInt = parseInt(target.id.charAt(target.id.length-1))+1;
		var nextInt = lastInt + 1;
		var selectTagId = target.parentElement.parentElement.querySelectorAll('.'+idOnly+lastInt)[0].id;
		//사업지구에 대한 리스트 생성
		var resultData;
		if(idOnly == "ds" || idOnly == "invDs"){
			resultData = getCodeAjax('DSTRC',$(this).val());
		}else{
			resultData = getCodeAjax('CMMN',$(this).val());
		}
		if(resultData.codeList.length == 0 || target.selectedOptions[0].innerText == '전체'){
			$('#'+selectTagId).val('');
			$('#'+selectTagId).css('display','none');
		}else{
			if($(this).val()!=""){
				devInfoOptionset(resultData.codeList,selectTagId,'전체','없음');
				$('#'+selectTagId).css('display','block');
			}
		}
	});
	
	//map.do 간편검색
	/*$("#simpleDevInfoSearchBtn").on('click',function(e){
		var params = $("#mapDevInfoForm").serializeArray();
		if(params[0].value == ""){
			alert('지역을 선택해 주세요');
		}else{
			var legaldongNm = {'name':'textSearch','value':$('#area3 option:selected').text()};
			params.push(legaldongNm);
			$.ajax({
		        type : 'POST',
		        url : getContextPath()+"/devlopInfo/selectSimpleList.do",
		        async: false,
		        datatype : 'json',
		        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
		        data: params,
		        success : function(data){ 
		        	var resData = JSON.parse(data);
	        	},
	            error:function(e){
	            	console.log(e);
	            	alert('selectSimpleList 조회 실패' + e);
	        	}
			});
			
		}
	});*/
});

// ================================  관리자  START =============================
//개발사업 정보 목록
function devInfoListSearch(initVal,lon,lat){
	var paginationDiv = $('#devInfoListPagination');
	paginationInit(paginationDiv);
	//Page index
	//var params = $('#listForm').serializeArray();
	var params = $('#devInfoInfoListForm').serializeArray();
	//처음 맵을 띄울때는 검색리스트가 안나오게설정
	
	params.push({name:'initVal',value:initVal});
	//읍면동은 선택한 텍스트로 Like 검색
	params.push({'name':'area3','value':$('#area3 option:selected').text()});
	
	if(lon!=null){
		//params 좌표를 뺀 나머지 조건 초기화
		params=[];
		params.push({name:'initVal',value:initVal});
		params.push({name:'lon',value:lon});
		params.push({name:'lat',value:lat});
		//페이징
	}
	
	var dataHtml='';
	var resData; 
	$('.wrap-loading').removeClass('display-none');
	setTimeout(function() {
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/selectList.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){ 
	        	resData = JSON.parse(data);
	        	var sortArea1List = resData.area1List.sort(function(a, b) {
	        	    return a.lowestAreaNm < b.lowestAreaNm ? -1 : a.lowestAreaNm > b.lowestAreaNm ? 1 : 0;
	        	});
	    		var dsCodeListAll = resData.dsCodeListAll.sort(function(a, b) {
	    			return a.codeIdNm < b.codeIdNm ? -1 : a.codeIdNm > b.codeIdNm ? 1 : 0;
	    		});
	        	var cpCodeList = resData.cpCodeList.sort(function(a, b) {
	        	    return a.codeIdNm < b.codeIdNm ? -1 : a.codeIdNm > b.codeIdNm ? 1 : 0;
	        	});
	        	if(initVal == 'init'){
	        		devInfoOptionset(sortArea1List,'area1','전체','없음');
	        		devInfoOptionset(resData.dsCodeList,'ds1','전체','없음');
	        		devInfoOptionset(cpCodeList,'cp1','전체','없음');
	        		devInfoOptionset(resData.cmCodeList,'rw1','전체','없음');
	        		//투자정보(정선)OptionSet 추가
	        		devInfoOptionset(sortArea1List,'invArea1','전체','없음');
	        		devInfoOptionset(resData.dsCodeList,'invDs1','전체','없음');
	        	}else{
		        	if(resData.resultList.length!=0){
		        		if(initVal!='pageOnly'){
		        			viewLayer(resData.LayerList,"gz_devlop_info",dsCodeListAll);
		        		}
			        	resData.resultList.forEach(function(data, index){ 
			        		//지역1,지역2 코드명
			            	var area1_val = devInfoCodeSet(resData.area1List,data.upperMapCode);
			        		//var area2_val = devInfoCodeSet(getCodeAjax('AREA',data.upperMapCode).codeList,data.mapCode);
			        		var ds_val = devInfoCodeSet(dsCodeListAll,data.bsnsDstrcCode);
			        		
			        		dataHtml += "<div class='item' id='" + data.devlopInfoSn + "' style='cursor: pointer;'>";
							dataHtml += "<button class='devInfoListClick link'>";
							dataHtml += "<strong><em>"+ds_val+"</em>"+data.dwkNm+"</strong>";
							dataHtml += "<span>"+data.addr+"</span>";
							dataHtml += "</button>";
			    			dataHtml += "</div>";
			        	});
			        	/*if(resData.resultListTotCnt == 0){
			    			dataHtml += "<tr><td style='border: solid 1px ;text-align: center;'colspan='7'>없음</td></tr>";
			    			
			    		}else{
				        	resData.resultList.forEach(function(data, index){
				        		//지역1,지역2 코드명
				            	var area1_val = devInfoCodeSet(resData.area1List,data.upperMapCode);
				        		var area2_val = devInfoCodeSet(getCodeAjax('AREA',data.upperMapCode).codeList,data.mapCode);
				        		
			        			dataHtml += "<tr id='" + data.devlopInfoSn + "' style='cursor: pointer;'>";
			        			dataHtml += "<td class='listtd'>" + data.dwkNo +"</td>";
			        			dataHtml += "<td class='listtd'>" + data.dwkNm + "</td>";
			        			dataHtml += "<td class='listtd'>" + area1_val + "</td>";
			        			dataHtml += "<td class='listtd'>" + area2_val + "</td>";
			        			dataHtml += "<td class='listtd'>" + data.frstRegisterId + "</td>";
			        			dataHtml += "<td class='listtd'>" + data.frstRegistPnttm + "</td>";
			        			dataHtml += "<td class='listtd'>" + data.lastUpdtPnttm + "</td>";
			        			dataHtml += "</tr>";
				        	});
			    		}*/
			        	
			        	//$('#total-count').html(resData.resultListTotCnt);
			        	//$('#tbodyContents').html(dataHtml);
			        	//Layer 리스트 별도 조회
			        	
			        	
			        	makeDevInfoPagination(paginationDiv,resData.resultListTotCnt,resData.paginationInfo.currentPageNo, 10);
		        	}else{
		        		dataHtml += "<div class='item' id='' style='cursor: pointer;'>";
						dataHtml += "<button>";
						dataHtml += "<strong>검색 결과가 없습니다</strong>";
						dataHtml += "</button>";
		    			dataHtml += "</div>";
			        	
		        	}
		        	$('#devInfoTotalCount').html(resData.resultListTotCnt);
		        	$('#devInfoCntList').html(dataHtml);
	        	}
	        	/*page(resData.resultListTotCnt);*/
	        	/*$('#pagination').children;*/
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('devlopinfo_list_조회 실패' + e);
	    	},complete:function(){
	        	$('.wrap-loading').addClass('display-none');
	    		flag = true;
	    	}
	    });
	}, 0);
}
//상세보기 -- 관리자
function devlopInfoDetail(devlopInfoSn){
	//Page index
	var params = {'devlopInfoSn' : devlopInfoSn};
	var dataHtml;
	var resData; 
	
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectDetail.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: params,
        success : function(data){
        	resData = JSON.parse(data);
        	$('#devlopInfoDetailModal').css('display','block');
        	
        	var sortArea1List = resData.area1List.sort(function(a, b) {
        	    return a.lowestAreaNm < b.lowestAreaNm ? -1 : a.lowestAreaNm > b.lowestAreaNm ? 1 : 0;
        	});
        	var dsCodeList = resData.dsCodeList.sort(function(a, b) {
        	    return a.lowestAreaNm < b.lowestAreaNm ? -1 : a.lowestAreaNm > b.lowestAreaNm ? 1 : 0;
        	});
        	
        	//지역1,지역2 코드명
        	var area1_val = devInfoCodeSet(resData.area1List,resData.resultList.upperMapCode);
    		//var area2_val = devInfoCodeSet(getCodeAjax('AREA',resData.resultList.upperMapCode).codeList,resData.resultList.mapCode);
    		
    		devInfoOptionset(sortArea1List,'detailArea1','전체',resData.resultList.upperMapCode);
    		devInfoOptionset(getCodeAjax('AREA',resData.resultList.upperMapCode).codeList,'detailArea2','전체',resData.resultList.mapCode);
    		devInfoOptionset(resData.dsCodeList,'detailDsCodeList','사업지구',resData.resultList.bsnsDstrcCode);
    		
        	document.detailForm.applcLaw.value = resData.resultList.applcLaw;
        	document.detailForm.bsnsArMeter.value = resData.resultList.bsnsArMeter;
        	document.detailForm.bsnsArPyeong.value = resData.resultList.bsnsArPyeong;
        	document.detailForm.bsnsCn.value = resData.resultList.bsnsCn;
        	document.detailForm.bsnsMthdCode.value = resData.resultList.bsnsMthdCode;
        	document.detailForm.bsnsrcognNtfcNm.value = resData.resultList.bsnsrcognNtfcNm;
        	document.detailForm.chrgDept.value = resData.resultList.chrgDept;
        	document.detailForm.dwkNm.value = resData.resultList.dwkNm;
        	document.detailForm.dwkOthbcAt.value = resData.resultList.dwkOthbcAt;
        	document.detailForm.expectRewardCode.value = resData.resultList.expectRewardCode;
        	document.detailForm.gzMent.value = resData.resultList.gzMent;
        	document.detailForm.opertnCmpny.value = resData.resultList.opertnCmpny;
        	document.detailForm.wrterOpinion.value = resData.resultList.wrterOpinion;
        	//UUID
        	document.detailForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	//추진내역에도 개발사업 일련번호 추가
        	document.prtnListForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	//추진내역 등록시 필요한 개발사업번호/개발사업정보UUID
        	document.detailForm.dwkNo.value = resData.resultList.dwkNo;
        	document.prtnInsertForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	
        	prtnListSearch();
        },
        error:function(e){
        	console.log(e);
        	alert('devlopinfo_Detail_조회 실패' + e);
    	}
	});
}

//개발정보 등록 -- 관리자
function devlopInfoInsert(){
	var params = $('#InsertForm').serializeArray();
	var dataHtml;
	var resData;
	var yn = confirm("등록하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/insertDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.insertResult == 1){
	        		alert('등록완료');
	        		listSearch();
	        	}else{
	        		alert('등록실패');
	        	}
	        	$('#devlopInfoInsertModal').css('display','none');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('devlopinfo_Insert_등록 실패' + e);
	    	}
		});
	}
}

//개발정보 수정 -- 관리자
function devlopInfoUpdate(){
	var params = $('#detailForm').serializeArray();
	var dataHtml;
	var resData;
	var yn = confirm("수정하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/updateDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.updateResult == 1){
	        		alert('수정완료');
	        		devInfoListSearch('Search',null,null);
	        	}else{
	        		alert('수정실패');
	        	}
	        	$('#devlopInfoDetailModal').css('display','none');
	        	$('#devlopInfoDetailModal').css('display','block');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('devlopinfo_Update_수정 실패' + e);
	    	}
		});
	}
}
//개발정보 삭제 -- 관리자
function devlopInfoDelete(){
	var params = $('#detailForm').serialize();
	var dataHtml;
	var resData;
	var yn = confirm("삭제하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/deleteDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.updateResult == 1){
	        		alert('삭제완료');
	        	}else{
	        		alert('삭제실패');
	        	}
	        	devInfoListSearch('Search',null,null);
	        	$('#devlopInfoDetailModal').css('display','none');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('devlopinfo_Detail_조회 실패' + e);
	    	}
		});
	}
}

//추진내역 목록 -- 관리자
function prtnListSearch(){
	
	//Page index
	var params = $('#prtnListForm').serializeArray();
	var dataHtml;
	var resData; 
	
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectPrtnList.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: params,
        success : function(data){ 
        	resData = JSON.parse(data);
        	if(resData.resultList.length != 0){
        		resData.resultList.forEach(function(data, index){
	        		dataHtml += "<tr id='" + data.bsnsPrtnSttusSn + "' style='cursor: pointer;'>";
	        		//현재 UUID 인데 너무 길어서 대체 필요할듯으로 보임
	        		dataHtml += "<td class='listtd'>" + data.bsnsPrtnSttusSn +"</td>";
	    			dataHtml += "<td class='listtd'>" + data.prtnBgnde +"</td>";
	    			dataHtml += "<td class='listtd'>" + data.prtnEndde + "</td>";
	    			dataHtml += "<td class='listtd'>" + data.sj + "</td>";
	    			dataHtml += "<td class='listtd'>" + data.relateKwrd + "</td>";
	    			//구분인데 구분코드로 임시 대체
	    			dataHtml += "<td class='listtd'>" + data.prtnSeCode + "</td>";
	    			//첨부파일명인데 첨부파일 임시 대체
	    			dataHtml += "<td class='listtd'>" + data.atchFileId + "</td>";
	    			dataHtml += "</tr>";
        		});
        	}else{
        		dataHtml += "<tr><td style='border: solid 1px ;text-align: center;'colspan='7'>없음</td></tr>";
        	}
        	$('#prtnListTbodyContents').html(dataHtml);
        },
        error:function(e){
        	console.log(e);
        	alert('prtn_devlopinfo_list_조회 실패' + e);
    	}
    });
}

//추진내역 등록 폼 보이기 -- 관리자
function showInsertForm(){
	//dwkNo 개발사업번호
	document.prtnInsertForm.dwkNo.value = document.detailForm.dwkNo.value;
}

//추진내역 상세보기 보이기 -- 관리자
function showDetailForm(bsnsPrtnSttusSn){
	var params = {'bsnsPrtnSttusSn' : bsnsPrtnSttusSn};
	if(params.bsnsPrtnSttusSn != ""){
		var dataHtml;
		var resData; 
		
		$.ajax({
		    type : 'POST',
		    url : getContextPath()+"/devlopInfo/selectPrtnDetail.do",
		    async: false,
		    datatype : 'json',
		    contentType: 'application/x-www-form-urlencoded;charset=utf-8',
		    data: params,
		    success : function(data){
		    	resData = JSON.parse(data);
		    	document.prtnDetailForm.dwkNo.value = resData.resultList.dwkNo;
		    	document.prtnDetailForm.prtnSeCode.value = resData.resultList.prtnSeCode;
		    	document.prtnDetailForm.sj.value = resData.resultList.sj;
		    	document.prtnDetailForm.prtnBgnde.value = resData.resultList.prtnBgnde;
		    	document.prtnDetailForm.prtnEndde.value = resData.resultList.prtnEndde;
		    	document.prtnDetailForm.relateKwrd.value = resData.resultList.relateKwrd;
		    	document.prtnDetailForm.atchFileId.value = resData.fileList[0].orignlFileNm;
		    	//UUID
		    	document.prtnDetailForm.bsnsPrtnSttusSn.value = resData.resultList.bsnsPrtnSttusSn;
		    	document.prtnDetailForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
		    	
		    	
		    	prtnListSearch();
		    },
		    error:function(e){
		    	console.log(e);
		    	alert('prtn_Devlopinfo_Detail_조회 실패' + e);
			}
		});
	}else{
		alert('추진내역이 없습니다');
		$('#prtnDetailContentsDiv').css('display','none');
	}
}
//추진내역 등록 -- 관리자
function PrtnInsert(){
	//파일첨부가 있는경우
	var form = $('#prtnInsertForm')[0];
	if(""!=form[name='atchFileId_file'].value){
		alert('있음');
		var formData = new FormData(form);
		//파일업로드
		var returnFileId = fileUpload(formData);
		document.prtnInsertForm.atchFileId.value = returnFileId;
	}else{
		alert('없음');
	}
	var params = $('#prtnInsertForm').serializeArray();
	var dataHtml;
	var resData;
	var yn = confirm("등록하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/insertPrtnDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.updateResult == 1){
	        		alert('등록완료');
	        		prtnListSearch();
	        	}else{
	        		alert('등록실패');
	        	}
	        	$('#prtnInsertContentsDiv').css('display','none');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('prtn_Devlopinfo_Insert_등록 실패' + e);
	    	}
		});
	}
}
//추진내역 등록 -- 관리자
function fileUpload(formData){
	var resultFileId;
	var dataHtml;
	var resData;
	$.ajax({
		type : 'POST',
		url : getContextPath()+"/devlopInfo/fileUpload.do",
		async: false,
		datatype : 'json',
		contentType: false,
        processData: false,
		enctype: 'multipart/form-data',
		data: formData,
		success : function(data){
			resData = JSON.parse(data);
			if(""!=resData.atchFileId){
				resultFileId = resData.atchFileId;
			}else{
				alert('파일 업로드실패');
			}
		},
		error:function(e){
			console.log(e);
			alert('prtn_Devlopinfo_Insert_파일 업로드실패' + e);
		}
	});
	return resultFileId;
}

//추진내역 수정 -- 관리자
function PrtnUpdate(){
	var params = $('#prtnDetailForm').serializeArray();
	var dataHtml;
	var resData;
	var yn = confirm("수정하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/updatePrtnDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.updateResult == 1){
	        		alert('수정완료');
	        		prtnListSearch();
	        	}else{
	        		alert('수정실패');
	        	}
	        	$('#prtnDetailContentsDiv').css('display','none');
	        	$('#prtnDetailContentsDiv').css('display','block');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('prtn_Devlopinfo_Update_수정 실패' + e);
	    	}
		});
	}
}
//추진내역 삭제 -- 관리자
function PrtnDelete(){
	var params = $('#prtnDetailForm').serialize();
	var dataHtml;
	var resData;
	var yn = confirm("삭제하시겠습니까?");
	if(yn){
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/deletePrtnDetail.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	resData = JSON.parse(data);
	        	if(resData.updateResult == 1){
	        		alert('삭제완료');
	        	}else{
	        		alert('삭제실패');
	        	}
	        	prtnListSearch();
	        	$('#prtnDetailContentsDiv').css('display','none');
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('prtn_Devlopinfo_Delete_삭제 실패' + e);
	    	}
		});
	}
}
// ============================ 관리자 END ===========================
//============================ 사용자 START ===========================
//개발정보 상세보기 -- 사용자
function devInfoDtl(devlopInfoSn,from){
	//Page index
	var params = {'devlopInfoSn' : devlopInfoSn};
	var dataHtml;
	var resData; 
	
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectDetail.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: params,
        success : function(data){
        	resData = JSON.parse(data);
        	if(from=='from'){
        		var inputList=[];
        		inputList.push(resData.resultList)
        		viewLayer(inputList,"gz_devlop_info",resData.dsCodeList);
        	}
        	$('#devInfoDtlForm').parents('#info').css('display','block');
        	
        	var cmCode = devInfoCodeSet(resData.cmCodeList, resData.resultList.bsnsMthdCode);
        	var area1_val = devInfoCodeSet(resData.area1List,resData.resultList.upperMapCode);
        	var area2_val = devInfoCodeSet(getCodeAjax('AREA',resData.resultList.upperMapCode).codeList,resData.resultList.mapCode);
        	var mbCode_val = devInfoCodeSet(resData.mbCodeList,resData.gradCode);
        	
        	$('#devInfoDtl_area').html(area1_val+' '+area2_val);
        	$('#devInfoDtl_dwkNm').html(resData.resultList.dwkNm);
        	
    		$('#devInfoDtl_addr').html(resData.resultList.addr);
    		$('#devInfoDtl_bsnsAr').html(resData.resultList.bsnsArPyeong+'평('+resData.resultList.bsnsArMeter+'m<sup>2</sup>)');
    		$('#devInfoDtl_opertnCmpny').html(resData.resultList.opertnCmpny);
    		$('#devInfoDtl_applcLaw').html(resData.resultList.applcLaw);
    		$('#devInfoDtl_bsnsMthdCode').html(cmCode);
    		$('#devInfoDtl_bsnsrcognNtfcNm').html(resData.resultList.bsnsrcognNtfcNm);
    		$('#devInfoDtl_bsnsCn').html(rbAply('\\r\\n',resData.resultList.bsnsCn));
    		//if(resData.login)
    		var chkVal = mbGradeChk(resData.gradCode);
    		if(chkVal){
	    		$('#devInfoDtl_gzMent').html(rbAply('\\r\\n', resData.resultList.gzMent));
    		}else{
    			$('#devInfoDtl_gzMent').html('<li class="primium">프리미엄 등급 전용<img src="'+getContextPath()+'/images/develop/premium.png"></li>');
    		}
    		//첨부파일& 썸네일
    		if(resData.oldFileMap){
    			createFileListHtml(chkVal,'devInfoDtl_thumbnail','devInfoDtl_fileList',resData.oldFileMap);
    		}
    		/*
        	document.devInfoDtlForm.wrterOpinion.value = resData.resultList.wrterOpinion;
        	//UUID
        	document.devInfoDtlForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	//추진내역에도 개발사업 일련번호 추가
        	document.devInfoDtlForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	//추진내역 등록시 필요한 개발사업번호/개발사업정보UUID
        	document.devInfoDtlForm.dwkNo.value = resData.resultList.dwkNo;
        	document.devInfoDtlForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
        	
        	prtnListSearch();*/
    		document.devInfoDtlForm.dwkNm.value = resData.resultList.dwkNm;
    		document.devInfoDtlForm.dwkNo.value = resData.resultList.dwkNo;
    		document.devInfoDtlForm.devlopInfoSn.value = resData.resultList.devlopInfoSn;
    		devInfoPrtnListSearch(resData.searchVO.devlopInfoSn);
        },
        error:function(e){
        	console.log(e);
        	alert('devInfoDtl_조회 실패' + e);
    	}
	});
}
//관련기사
function devInfoArticle(dwkNm){
	var params = {"dwkNm":dwkNm};
	document.devInfoDtlForm.action = getContextPath()+"/devlopInfo/selectNwsListByDwkNm.do";
	document.devInfoDtlForm.submit();
	document.devInfoDtlForm.pageIndex.value = 1;
}
//관심정보 등록 -- 사용자
function devInfoIntrst(dwkNo){
	var params = {"dwkNo":dwkNo};
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectIntrstList.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: params,
        success : function(data){
        	var resData = JSON.parse(data);
        	devInfoOptionset(resData.IntrstList,'devlopIntrstThingSn','전체','없음');
        },
        error:function(e){
        	console.log(e);
        	alert('selectIntrstList_조회 실패' + e);
    	}
	});
}
//관심정보 등록 ---- 사용자
function devInfoIntrstInsert(dwkNo){
	var params = $('#devInfoIntrst').serializeArray();
	var gnText = $('#devlopIntrstThingSn option:selected').text();
	if(gnText !='전체'){
		params.push({'name':'intrstGroupNm','value':gnText});
		params.push({'name':'dwkNo','value':dwkNo});
		$.ajax({
	        type : 'POST',
	        url : getContextPath()+"/devlopInfo/InsertIntrst.do",
	        async: false,
	        datatype : 'json',
	        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
	        data: params,
	        success : function(data){
	        	var resData = JSON.parse(data);
	        	if(resData.insertIntrstResult==1){
	        		alert('관심정보를 추가하였습니다');
	        		//모달닫기
	        		$('#devInfoModifyGroup').parents('.modal').css('display','none');
	        	}
	        },
	        error:function(e){
	        	console.log(e);
	        	alert('selectIntrstInsert 관심정보 등록 실패' + e);
	    	}
		});
	}else{
		alert('관심그룹을 선택해주세요');
	}
	
}

function devInfoInvtList(dwkNo){
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectInvtListBydwkNo.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: {'dwkNo':dwkNo},
        success : function(data){
        	var resData = JSON.parse(data);
        	if(resData.invtList){
        		var dataHtml = "";
	        	resData.invtList.forEach(function(data, index){
	        		//지역1,지역2 코드명
	            	var area1_val = codeSet(resData.area1List,data.upperMapCode);
	        		var area2_val = codeSet(getCodeAjax('AREA',data.upperMapCode).codeList,data.mapCode);
	        		var reward ;
	        		if(data.rewardAt == "Y"){
	        			reward = "보상중"
	        		}else {
	        			reward = "보상완료"
	        		}
	        		dataHtml += "<div class='item'>";
	        		dataHtml += "<a href='#' class='link'>";
	        		dataHtml += "<span class='td__category'>"+resData.aucYN+"</span>";
	        		dataHtml += "<div class='description'>";
	        		dataHtml += "<strong class='title'>";
	        		dataHtml += "<em>사건번호 : "+resData.courtNm + data.smCode+"계  "+ data.incdntManageNo +"["+data.thingNo+"]"+"</em>";
	        		dataHtml += "<i class='txt_blt03 state01'>"+reward+"</i></strong>";
	        		dataHtml += "<ul>";
	        		dataHtml += "<li class='mid_td'>사업명 :"+data.dwkNm+"</li>";
	        		dataHtml += "<li class='sma_td'>특급노하우 :"+data.rmOne+"</li>";
	        		dataHtml += "<li class='mid_td'>용도 :"+resData.prposNm+"</li>";
	        		dataHtml += "<li class='mid_td'>소재지 :"+area1_val+" "+area2_val+" "+data.addr+"(상세 주소 입력해야함)</li>";
	        		dataHtml += "<li class='mid_td'>편입면적 :"+data.incrprAr+"(편입면적 데이터 넣야함)</li>";
	        		dataHtml += "<li class='mid_td'>감정가 :"+data.apasmtAmount+"</li>";
	        		dataHtml += "<li class='mid_td'>최저가 :"+data.bidAmount+"</li>";
	        		dataHtml += "<li class='mid_td'>입찰일 :"+data.bidDe+"</li>";
	        		dataHtml += "<li class='mid_td'>상태 :"+resData.stusNm+"(코드 변경)</li>";
	        		dataHtml += "</ul></div>";
    	        	//dataHtml += "<span class='td__knowhow' data-toggle='tooltip' data-container='body' data-html='true' title='<h5>특급노하우</h5><ul><li>- 2020년 6월 30일 실효된 구간 內 해당 물건임.</li>'";
    	        	//dataHtml += "<li>- 전체면적 1,785㎡ 中 입찰지분 1,723.1㎡</li></ul>'>특급노하우</span>";
	        		dataHtml += "</a></div></div>";
	        	});
        	}else{
        		dataHtml = "<tr><td style='border: solid 1px ;text-align: center;'colspan='7'>없음</td></tr>";
        	}
        	$('#devInfoDtlInvtContent').html(dataHtml);
        },
        error:function(e){
        	console.log(e);
        	alert('selectInvtListBydwkNo 투자정보 조회 실패' + e);
    	}
	});
}
//추진내역 목록 -- 사용자
function devInfoPrtnListSearch(devlopInfoSn){
	//Page index
	var params = {'devlopInfoSn':devlopInfoSn};
	var prtnListHtml ="";
	var prtnPlanListHtml ="";
	var prtnChk = false;
	var prtnPlanChk = false;
	var resData; 
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectPrtnList.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: params,
        success : function(data){ 
        	resData = JSON.parse(data);
        	
        	if(resData.resultList.length != 0){
        		resData.resultList.forEach(function(data, index){
        			if(data.prtnSeCode == '1'){
        				//prtnListHtml += "<li id='" + data.bsnsPrtnSttusSn + "' style='cursor: pointer;'>";
        				prtnListHtml += "<li id='" + data.bsnsPrtnSttusSn + "'>";
        				prtnListHtml += "<strong>" + new Date(data.prtnBgnde).format('yyyy.MM.dd') +"</strong>";
        				prtnListHtml += "<span>" + data.sj + "</span>";
        				prtnListHtml += "</li>";
        				prtnChk = true;
        			}else{
        				//prtnListHtml += "<li id='" + data.bsnsPrtnSttusSn + "' style='cursor: pointer;'>";
        				prtnPlanListHtml += "<li id='" + data.bsnsPrtnSttusSn + "'>";
        				prtnPlanListHtml += "<strong>" + new Date(data.prtnBgnde).format('yyyy.MM.dd') +"</strong>";
        				prtnPlanListHtml += "<span>" + data.sj + "</span>";
        				prtnPlanListHtml += "</li>";
        				prtnPlanChk = true;
        			}
        		});
        	}
        	if(prtnChk == false){
        		prtnListHtml += "<li>추진내역 없음</li>";
        	}
        	if(prtnPlanChk  == false){
        		prtnPlanListHtml += "<li>추진내역 없음</li>";
        	}
        	$('#devInfoDtl_prtnList').html(prtnListHtml);
        	$('#devInfoDtl_prtnPlanList').html(prtnPlanListHtml);
        },
        error:function(e){
        	console.log(e);
        	alert('prtn_devlopinfo_list_조회 실패' + e);
    	}
    });
}
//============================ 사용자 END ===========================

// ============================ 유틸 ====================================
function paginationInit(paginationDiv){
	paginationDiv.empty();
	paginationDiv.removeData("twbs-pagination");
	paginationDiv.unbind("page");
}

function makeDevInfoPagination(paginationDiv,totalPages, currentPageNo, pageCount){
	var totalPagesOption;
	var visiblePage = pageCount;
	var pageCal = totalPages/visiblePage;
	var pageCalRemain = totalPages%visiblePage;
	if(pageCalRemain == 0){
		totalPagesOption = pageCal;
	}else{
		totalPagesOption = pageCal + 1;
	}
	paginationDiv.twbsPagination({
	    totalPages: totalPagesOption,	// 총 페이지 번호 수
	    visiblePages: visiblePage,	// 하단에서 한번에 보여지는 페이지 번호 수
	    startPage : currentPageNo, // 시작시 표시되는 현재 페이지
	    initiateStartPageClick: false,	// 플러그인이 시작시 페이지 버튼 클릭 여부 (default : true)
	    first : "<<",	// 페이지네이션 버튼중 처음으로 돌아가는 버튼에 쓰여 있는 텍스트
	    prev : "<",	// 이전 페이지 버튼에 쓰여있는 텍스트
	    next : ">",	// 다음 페이지 버튼에 쓰여있는 텍스트
	    last : ">>",	// 페이지네이션 버튼중 마지막으로 가는 버튼에 쓰여있는 텍스트
	    nextClass : "page-item Next",	// 이전 페이지 CSS class
	    prevClass : "page-item Previous",	// 다음 페이지 CSS class
	    lastClass : "page-item last",	// 마지막 페이지 CSS calss
	    firstClass : "page-item first",	// 첫 페이지 CSS class
	    pageClass : "page-item",	// 페이지 버튼의 CSS class
	    activeClass : "active",	// 클릭된 페이지 버튼의 CSS class
	    disabledClass : "disabled",	// 클릭 안된 페이지 버튼의 CSS class
	    anchorClass : "page-link",	//버튼 안의 앵커에 대한 CSS class
	    
	    onPageClick: function (event, page) {
	    	//클릭 이벤트
	    	document.devInfoInfoListForm.pageIndex.value = page;
	    	devInfoListSearch('pageOnly',null,null);
	    }
	});
	paginationDiv.children().children('.first').children('a').attr('aria-label','first');
	paginationDiv.children().children('.Previous').children('a').attr('aria-label','Previous');
	paginationDiv.children().children('.Next').children('a').attr('aria-label','Next');
	paginationDiv.children().children('.last').children('a').attr('aria-label','last');
}

function devInfoCodeSet(inputParam , dataParam){
	var result;
	inputParam.forEach(function(data, index){
		if(data.legaldongCode){
			if(data.legaldongCode == dataParam){
				result = data.lowestAreaNm;
			}
		}
		if(data.codeId){
			if(data.codeId == dataParam){
				result = data.codeIdNm;
			}
		}
	});
	return result;
}

function devInfoOptionset(codeList,selectTagId,firstStr,selVal){
	var strHtml = ""; 
	strHtml += "<option value=''>" + firstStr + "</option>";
	var idWoNo = selectTagId.substring(0,selectTagId.length-1);
	switch(selectTagId){
		case 'insertDsCodeList':
			break;
		case 'devlopIntrstThingSn':
			codeList.forEach(function(data){
				if(selVal == data.intrstThingSn){
					strHtml += "<option value='" + data.intrstThingSn + "'selected>" + data.intrstGroupNm +"</option>";
				}else{
					strHtml += "<option value='" + data.intrstThingSn + "'>" + data.intrstGroupNm +"</option>";	
				}
			});
			break;
		default:
			switch(idWoNo){
				case'ds':
				case'cp':
				case'rw':
				case'invDs':
					var spclTxt;
					codeList.forEach(function(data){
						//하위 Depth level이 있는 특수지구에게는 문자 마지막에 특수문자 부여
						if(idWoNo!='cp' && data.codeLevel == '1' && data.upperCodeAt == 'Y'){
							spclTxt = '&#9660';
						}else{
							spclTxt ='';
						}
						//조회 후 Select 값 유지
						if(data.codeIdNm !='직접입력'){
							if(selVal == data.codeId){
								strHtml += "<option value='" + data.codeId + "' selected>" + data.codeIdNm + " "+spclTxt+"</option>";
							}else{
								strHtml += "<option value='" + data.codeId + "'>" + data.codeIdNm + " "+spclTxt+"</option>";	
							}
						}
					});
					break;
				case'area':
				case'invArea':
					codeList.forEach(function(data){
						//조회 후 Select 값 유지
						if(selVal == data.legaldongCode){
							strHtml += "<option value='" + data.legaldongCode + "' selected>" + data.lowestAreaNm + "</option>";
						}else{
							strHtml += "<option value='" + data.legaldongCode + "'>" + data.lowestAreaNm + "</option>";	
						}
					});
					break;
			}
			break;
	}
	$('#'+selectTagId).html(strHtml);
}

function getCodeAjax(codeKey,codeVal){
	var resultData;
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectCodeList.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        data: {'codeKey':codeKey ,'codeVal':codeVal},
        success : function(data){
        	resultData = JSON.parse(data);
        },
        error:function(e){
        	console.log(e);
        	alert('select_CodeList_조회 실패' + e);
    	},complete:function(){
    	}
	});
	return resultData;
}

function rbAply(frontStr, input){
	var resultHtml = '';
	var strList = input.split(frontStr);
	strList.forEach(function(data,index){
		if(index !=0){
			var subStr = data;
			/*if(strList.length-1 != index){
				subStr = data.substring(0,data.length-4);
			}*/
			resultHtml +="<li>";
			//if(frontStr!='◈'){
			resultHtml += subStr;
			/*}else{
				resultHtml += frontStr + subStr;	
			}*/
			resultHtml +="</li>";
		}
	});
	return resultHtml;
}
function mbGradeChk(mbCode){
	var chkRe = false;
	switch(mbCode){
		case'CM00200002':
		case'CM00200004':
		case'CM00200010':
		case'CM00200011':
			chkRe = true;
			break;
		default:
			break;
	}
	return chkRe;
}

function recDevInfoLogHist(){
	$.ajax({
        type : 'POST',
        url : getContextPath()+"/devlopInfo/selectRecDevInfoLog.do",
        async: false,
        datatype : 'json',
        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
        success : function(data){
        	var resultData = JSON.parse(data);
        	var recDevHtml= '';
        	if(resultData.recLogList){
        		resultData.recLogList.forEach(function(data,index){
        			data
        		});
        	}
        	recDevHtml = '<li class="notice-text"><a href="#">장기미집행 도시계획시설(노원로1-391호선) </a></li>'
					
					$('#recClickDevInfo').html();
        },
        error:function(e){
        	console.log(e);
        	alert('select_CodeList_조회 실패' + e);
    	},complete:function(){
    	}
	});
	return resultData;
}
function createFileListHtml(chkVal,tumbnailDiv,filedownDiv,fileMap){
	var tumbnailHtml = '';
	var filedownHtml = '';
	var fileMapList = [];
	var newMap = {fileNm:'',filePath:'',fileDisNm:''};
	for(let key in fileMap){
		if(key.includes('fileNm')){
			newMap.fileNm=fileMap[key];
		}else if(key.includes('filePath')){
			newMap.filePath=fileMap[key];
		}else if(key.includes('fileDisNm')){
			newMap.fileDisNm=fileMap[key];
			fileMapList.push(newMap);
			newMap = {fileNm:'',filePath:'',fileDisNm:''};
		}
	}
	fileMapList.forEach(function(data,index){
		if(data.fileDisNm != 'null'){
			tumbnailHtml += "<img src='"+getContextPath()+"/images/develop/"+data.filePath+"/"+data.fileNm+"'>"
		}else{
			if(chkVal){
				
				filedownHtml +="<div class='fileDiv banner__box down'>";
				filedownHtml +="<a class='down' href='/develop/"+data.filePath+data.fileNm+"' download='"+data.fileDisNm+"'>";
//				filedownHtml +="<a class='down' data-fileNm='"+data.fileNm+"' data-fileDisNm='"+data.fileDisNm+"' data-filePath='"+data.filePath+"' download>";
				filedownHtml +="<strong class='ui-banner__title'>"+data.fileDisNm +"</strong>";
				filedownHtml +="</a>";
				filedownHtml +="</div>";
			}
				
		}
	});
	if(!chkVal){
		filedownHtml +="<ul>";
		filedownHtml +='<li class="primium">프리미엄 등급 전용<img src="'+getContextPath()+'/images/develop/premium.png"></li>';
		filedownHtml +="</ul>";
	}
	$('#'+tumbnailDiv).html(tumbnailHtml);
	$('#'+filedownDiv).html(filedownHtml);
}
//데이트형식 prototype
Date.prototype.format = function(f) {
    if (!this.valueOf()) return " ";
 
    var weekName = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
    var d = this;
     
    return f.replace(/(yyyy|yy|MM|dd|E|hh|mm|ss|a\/p)/gi, function($1) {
        switch ($1) {
            case "yyyy": return d.getFullYear();
            case "yy": return (d.getFullYear() % 1000).zf(2);
            case "MM": return (d.getMonth() + 1).zf(2);
            case "dd": return d.getDate().zf(2);
            case "E": return weekName[d.getDay()];
            case "HH": return d.getHours().zf(2);
            case "hh": return ((h = d.getHours() % 12) ? h : 12).zf(2);
            case "mm": return d.getMinutes().zf(2);
            case "ss": return d.getSeconds().zf(2);
            case "a/p": return d.getHours() < 12 ? "오전" : "오후";
            default: return $1;
        }
    });
};
 
String.prototype.string = function(len){var s = '', i = 0; while (i++ < len) { s += this; } return s;};
String.prototype.zf = function(len){return "0".string(len - this.length) + this;};
Number.prototype.zf = function(len){return this.toString().zf(len);};

